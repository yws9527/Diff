# Diff 源码解析

[虚拟Dom核心库参考](https://www.npmjs.com/package/snabbdom): https://www.npmjs.com/package/snabbdom

#### 1. 如果新老节点不是同一个节点名称，那么就暴力删除旧的节点，创建插入新的节点。

#### 2. 只能同级比较，不能跨层比较。如果跨层那么就暴力删除旧的节点，创建插入新的节点。

#### 3. 如果是相同节点，情况分为多种：
  ```text
  3.1 新节点没有children
      - 如果新的节点没有children，那么说明新节点是文本，直接把旧的替换成新的文本
  3.2 新节点有children
      - 新的节点有children，旧的节点没有children ===> 创建元素添加（把旧的内容删除清空，创建插入新的）
      - 新的节点有children，旧的节点也有children ===> diff算法的核心【3.3】
  ```

  ```text
  3.3 diff算法的核心
    1. 旧前 和 新前 比较
        匹配：旧前的指针++、新前的指针++
    2. 旧后 和 新后 比较
        匹配：旧后的指针--、新后的指针--
    3. 旧前 和 新后 比较
        匹配：旧前的指针++、新后的指针--
    4. 旧后 和 新前 比较
        匹配：旧后的指针--、新前的指针++
    5. 以上情况都不满足 ===> 进行查找
        新的节点指针++，新的节点添加到页面上并且新的节点在旧的节点中存在，给旧的节点赋值成undefined
    6. 以上情况任然不满足，说明节点进行了 新增/删除
        创建或者删除节点
  ```
*** 注意：如果要提升性能，一定要加入key，key是唯一标识，在更改前后，确认是不是同一个节点。***
